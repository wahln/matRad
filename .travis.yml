language: cpp
group: travis_latest

os:
  - linux
  - osx
  - windows
  
matrix:
  allow_failures:
    - os: windows
    #- os: osx
 
addons:
  apt:
    packages:
      - octave
      
before_install: 
  - if [ "$TRAVIS_OS_NAME" == "osx"]; then brew install octave > /dev/null ; fi
  - if [ "$TRAVIS_OS_NAME" == "windows"]; then choco install octave.portable ; fi
  
  # Linux setup
  - if [ "$TRAVIS_OS_NAME" == "linux"]; then sudo chmod +x before_install.sh ; fi
  - if [ "$TRAVIS_OS_NAME" == "linux"]; then sudo chmod +x runtests.sh ; fi
  - if [ "$TRAVIS_OS_NAME" == "linux"]; then sudo chmod +x submodules/MCsquare/MCsquare_linux ; fi
  - if [ "$TRAVIS_OS_NAME" == "linux"]; then sudo ./before_install.sh
  
before_script:
  - if [ "$TRAVIS_OS_NAME" == "linux"]; then ulimit -c unlimited -S ; fi
  
  
after_failure:
  ## Linux stack trace
  # find core file
  - if [ "$TRAVIS_OS_NAME" == "linux"]; then COREFILE=$(find . -maxdepth 1 -name "core*" | head -n 1) ; fi 
  # print stack trace
  - if [ "$TRAVIS_OS_NAME" == "linux"]; then gdb -c "$COREFILE" -ex "thread apply all bt" -ex "set pagination 0" -batch /usr/bin/octave-cli ; fi
  - if [ "$TRAVIS_OS_NAME" == "linux"]; then tail runtests.log ; fi
  
script:
  - travis_wait 45 ./runtests.sh octave-cli

#notifications:
#    slack: e0404:u5tBXbO6D1mEwzJuFZV0MmqJ
